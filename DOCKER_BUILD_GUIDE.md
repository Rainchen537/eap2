# QuizOnly Docker æ„å»ºæŒ‡å—

## ğŸ”§ ä¿®å¤çš„é—®é¢˜

### 1. åç«¯æ„å»ºé”™è¯¯ä¿®å¤

**é—®é¢˜**: `nest: not found`
- **åŸå› **: Dockeræ„å»ºæ—¶åªå®‰è£…äº†ç”Ÿäº§ä¾èµ–ï¼Œç¼ºå°‘ `@nestjs/cli`
- **è§£å†³**: æ„å»ºé˜¶æ®µå®‰è£…æ‰€æœ‰ä¾èµ–ï¼Œç”Ÿäº§é˜¶æ®µåªå®‰è£…ç”Ÿäº§ä¾èµ–

### 2. å‰ç«¯æ„å»ºé”™è¯¯ä¿®å¤

**é—®é¢˜1**: `crypto.hash is not a function` å’Œ Node.js ç‰ˆæœ¬è¦æ±‚
- **åŸå› **: Vite 7.x è¦æ±‚ Node.js 20.19+ æˆ– 22.12+
- **è§£å†³**: å‡çº§ Docker é•œåƒä» `node:18-alpine` åˆ° `node:20-alpine`

**é—®é¢˜2**: `addgroup: group 'nginx' in use`
- **åŸå› **: nginx:alpine é•œåƒå·²åŒ…å« nginx ç”¨æˆ·å’Œç»„
- **è§£å†³**: ç§»é™¤é‡å¤çš„ç”¨æˆ·åˆ›å»ºå‘½ä»¤ï¼Œä½¿ç”¨ç°æœ‰çš„ nginx ç”¨æˆ·

**é—®é¢˜3**: TypeScript ç±»å‹é”™è¯¯
- **åŸå› **: ä¾èµ–ç‰ˆæœ¬æ›´æ–°å¯¼è‡´ç±»å‹ä¸å…¼å®¹
- **è§£å†³**: ä¿®å¤ç±»å‹å¯¼å…¥å’Œå®šä¹‰ï¼Œæä¾›è·³è¿‡ç±»å‹æ£€æŸ¥çš„æ„å»ºé€‰é¡¹

## ğŸ“¦ æ„å»ºè¦æ±‚

### ç³»ç»Ÿè¦æ±‚
- Docker 20.10+
- Docker Compose 2.0+
- è‡³å°‘ 4GB å¯ç”¨å†…å­˜

### Node.js ç‰ˆæœ¬
- **å‰ç«¯**: Node.js 20.19+ (Vite 7.x è¦æ±‚)
- **åç«¯**: Node.js 20+ (ä¿æŒä¸€è‡´æ€§)

## ğŸš€ æ„å»ºæ­¥éª¤

### æ–¹æ³•1: ç”Ÿäº§ç¯å¢ƒéƒ¨ç½² (æ¨è)

```bash
# ä½¿ç”¨ç”Ÿäº§ç¯å¢ƒé…ç½®ï¼ˆæ— MySQLå®¹å™¨ï¼‰
chmod +x deploy-prod.sh
./deploy-prod.sh
```

### æ–¹æ³•2: å¼€å‘ç¯å¢ƒ (åŒ…å«MySQLå®¹å™¨)

```bash
# æ„å»ºæ‰€æœ‰æœåŠ¡
docker-compose build

# å¯åŠ¨æ‰€æœ‰æœåŠ¡
docker-compose up -d

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f
```

### æ–¹æ³•2: å•ç‹¬æ„å»º

```bash
# æ„å»ºåç«¯
cd backend
docker build -t quizonly-backend .

# æ„å»ºå‰ç«¯
cd ../frontend
docker build -t quizonly-frontend .
```

### æ–¹æ³•3: ä½¿ç”¨æµ‹è¯•è„šæœ¬

```bash
# è¿è¡Œæ„å»ºæµ‹è¯•
chmod +x test-docker-build.sh
./test-docker-build.sh
```

## ğŸ” æ•…éšœæ’é™¤

### å¸¸è§é”™è¯¯

1. **nest: not found**
   - ç¡®ä¿ `@nestjs/cli` åœ¨ `devDependencies` ä¸­
   - æ„å»ºé˜¶æ®µä½¿ç”¨ `npm ci` è€Œä¸æ˜¯ `npm ci --only=production`

2. **crypto.hash is not a function**
   - å‡çº§åˆ° Node.js 20+
   - æ£€æŸ¥ Vite ç‰ˆæœ¬å…¼å®¹æ€§

3. **å†…å­˜ä¸è¶³**
   - å¢åŠ  Docker å†…å­˜é™åˆ¶
   - ä½¿ç”¨ `--max-old-space-size=4096` å‚æ•°

### è°ƒè¯•å‘½ä»¤

```bash
# æŸ¥çœ‹æ„å»ºæ—¥å¿—
docker-compose build --no-cache

# è¿›å…¥å®¹å™¨è°ƒè¯•
docker run -it --rm quizonly-backend:latest sh

# æ£€æŸ¥ Node.js ç‰ˆæœ¬
docker run --rm node:20-alpine node --version
```

## ğŸ“‹ éªŒè¯æ¸…å•

- [ ] Docker å’Œ Docker Compose å·²å®‰è£…
- [ ] ä½¿ç”¨ Node.js 20+ é•œåƒ
- [ ] åç«¯æ„å»ºæˆåŠŸ (nest build æ­£å¸¸)
- [ ] å‰ç«¯æ„å»ºæˆåŠŸ (vite build æ­£å¸¸)
- [ ] æ‰€æœ‰æœåŠ¡å¯åŠ¨æ­£å¸¸
- [ ] å¥åº·æ£€æŸ¥é€šè¿‡

## ğŸ¯ ç”Ÿäº§éƒ¨ç½²

### ç¯å¢ƒå˜é‡é…ç½®

```bash
# å¤åˆ¶ç¯å¢ƒå˜é‡æ¨¡æ¿
cp .env.example .env

# ç¼–è¾‘ç”Ÿäº§é…ç½®
vim .env
```

### å®‰å…¨å»ºè®®

1. æ›´æ”¹é»˜è®¤å¯†ç 
2. ä½¿ç”¨ HTTPS
3. é…ç½®é˜²ç«å¢™
4. å®šæœŸå¤‡ä»½æ•°æ®åº“
5. ç›‘æ§æ—¥å¿—

## ğŸ“ æ”¯æŒ

å¦‚æœé‡åˆ°æ„å»ºé—®é¢˜ï¼Œè¯·æ£€æŸ¥ï¼š
1. Docker ç‰ˆæœ¬æ˜¯å¦ç¬¦åˆè¦æ±‚
2. ç³»ç»Ÿå†…å­˜æ˜¯å¦å……è¶³
3. ç½‘ç»œè¿æ¥æ˜¯å¦æ­£å¸¸
4. ä¾èµ–ç‰ˆæœ¬æ˜¯å¦å…¼å®¹
